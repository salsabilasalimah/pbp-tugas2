{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    {% block meta %}
    <title>Meowl Store</title>
    {% endblock meta %}

    <link 
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
        rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
        crossorigin="anonymous"
    >
    <link rel="stylesheet" href="{% static 'css/global.css' %}"/>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>

    <style>
      body {
        background: linear-gradient(135deg, #e0f2fe, #bfdbfe);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: #1e3a8a;
        min-height: 100vh;
        margin: 0;
      }
      .card {
        border-radius: 1rem;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
      }
      .btn-primary {
        background-color: #2563eb;
        border: none;
      }
      .btn-primary:hover {
        background-color: #1d4ed8;
      }
      .navbar {
        background: rgba(30, 58, 138, 0.9) !important;
      }
    </style>
</head>
<body>
    {% block content %}
    {% endblock %}

    {% include 'toast.html' %}
    {% include 'modal.html' %}

    <div id="deleteConfirmModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
        <div class="bg-white rounded-lg p-6 shadow-xl">
            <h3 class="text-lg font-bold">Confirm Deletion</h3>
            <p class="my-4">Are you sure you want to delete this product?</p>
            <div class="flex justify-end gap-4">
                <button onclick="closeDeleteModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">Cancel</button>
                <button id="confirmDeleteButton" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Yes, Delete</button>
            </div>
        </div>
    </div>

    <script 
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" 
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" 
        crossorigin="anonymous">
    </script>

    <script>
        let productToDeleteId = null;

        // Fungsi untuk menampilkan modal konfirmasi
        function openDeleteModal(productId) {
            productToDeleteId = productId;
            document.getElementById('deleteConfirmModal').classList.remove('hidden');
        }

        // Fungsi untuk menutup modal konfirmasi
        function closeDeleteModal() {
            productToDeleteId = null;
            document.getElementById('deleteConfirmModal').classList.add('hidden');
        }
        
        // Fungsi yang dijalankan saat tombol "Yes, Delete" diklik
        async function confirmDelete() {
            if (!productToDeleteId) return;
            
            // Kirim request hapus ke server
            const response = await fetch(`/delete-product-ajax/${productToDeleteId}/`, { 
                method: 'POST',
                headers: {
                }
            });

            if (response.ok) {
                showToast('Success', 'Product has been deleted.', 'success');
                if (typeof fetchProductsFromServer === 'function') {
                    fetchProductsFromServer();
                }
            } else {
                showToast('Error!', 'Failed to delete the product.', 'error');
            }
            
            closeDeleteModal();
        }

        // Tambahkan event listener ke tombol konfirmasi
        document.getElementById('confirmDeleteButton').addEventListener('click', confirmDelete);
    </script>
</body>
</html>